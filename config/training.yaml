# AFlow + ROLL é›†æˆè®­ç»ƒé…ç½®

# å®éªŒé…ç½®
exp_name: "aflow_grpo_dynamic_prompts_v1"  # åŒå±‚æç¤ºè¯ä¼˜åŒ–+éªŒè¯é›†
output_dir: "checkpoints"
log_dir: "logs"
max_steps: 500  # æ€»è®­ç»ƒæ­¥æ•° (å¿«é€Ÿæ›´æ–°æ¨¡å¼)
save_every: 50  # æ¯Næ­¥ä¿å­˜ä¸€æ¬¡
eval_every: 10  # æ¯Næ­¥åœ¨éªŒè¯é›†è¯„ä¼°ä¸€æ¬¡
val_samples: 50  # éªŒè¯é›†æ ·æœ¬æ•°é‡
log_every: 5    # æ¯Næ­¥è®°å½•ä¸€æ¬¡

# GRPOç®—æ³•é…ç½®
adv_estimator: "grpo"
num_return_sequences_in_group: 6  # GRPOç»„å¤§å°ï¼šæ¯ä¸ªé—®é¢˜ç”Ÿæˆ6ä¸ªå·¥ä½œæµï¼ˆå¢åŠ å¤šæ ·æ€§ï¼‰
ppo_epochs: 1                      # åœ¨çº¿å­¦ä¹ ï¼šæ¯ä¸ªbatchåªè®­ç»ƒä¸€æ¬¡
async_generation_ratio: 0          # åŒæ­¥æ¨¡å¼ï¼š0è¡¨ç¤ºå®Œå…¨åŒæ­¥
use_kl_loss: true
kl_loss_coef: 0.01  # ä»0.001æé«˜åˆ°0.01ï¼Œé˜²æ­¢ç­–ç•¥åç¦»è¿‡å¿«
clip_range: 0.2
gamma: 1.0                         # æŠ˜æ‰£å› å­
lambda_gae: 0.95                   # GAE lambda

# Batché…ç½® - å¿«é€Ÿæ›´æ–°æ¨¡å¼: æ¯batchåç«‹å³æ›´æ–°
rollout_batch_size: 4              # æ¯æ‰¹é—®é¢˜æ•° (å¿«é€Ÿæ›´æ–°: æ¯16ä¸ªå·¥ä½œæµæ ·æœ¬æ›´æ–°ä¸€æ¬¡)
prompt_max_length: 3072            # å¢åŠ åºåˆ—é•¿åº¦
response_max_length: 5120          # å¢åŠ è¾“å‡ºé•¿åº¦

# æ¨¡å‹é…ç½®
base_model: "/home/yijia/verl-agent/models/qwen/Qwen2___5-7B-Instruct"  # ä½¿ç”¨æœ¬åœ°æ¨¡å‹ï¼Œé¿å…é‡å¤ä¸‹è½½
model_dtype: "bfloat16"

# LoRAé…ç½® - æ–¹æ¡ˆA: å¢åŠ å‚æ•°é‡
use_lora: true
lora_rank: 64                      # ä»32â†’64 (4å€å‚æ•°)
lora_alpha: 64                     # alphaé€šå¸¸ç­‰äºrank
lora_target_modules: "q_proj,k_proj,v_proj,o_proj"
lora_dropout: 0.05

# è®­ç»ƒå‚æ•°
learning_rate: 5.0e-6  # ä»1.0e-5é™ä½åˆ°5.0e-6
weight_decay: 0.01
max_grad_norm: 0.5     # ä»1.0é™ä½åˆ°0.5ï¼Œæ›´ä¿å®ˆçš„æ¢¯åº¦è£å‰ª
gradient_accumulation_steps: 2     # å‡å°‘ç´¯ç§¯æ­¥æ•°ï¼ˆbatchå˜å¤§äº†ï¼‰
warmup_steps: 50
bf16: true
gradient_checkpointing: false      # ä¸ZeRO-3å†²çªæ—¶ç¦ç”¨

# GPUé…ç½® - å•GPUæ¨¡å¼
device_mapping: [0]                # é€»è¾‘è®¾å¤‡0ï¼ˆCUDA_VISIBLE_DEVICES=2åå¯¹åº”ç‰©ç†GPU 2ï¼‰
physical_gpus: [2]                 # å®é™…ä½¿ç”¨çš„ç‰©ç†GPU 2
protected_pids: []                 # ä¸ä¿æŠ¤ä»»ä½•è¿›ç¨‹ï¼Œæ¸…ç†GPU 2ä¸Šçš„æ‰€æœ‰è¿›ç¨‹
num_gpus: 1                        # å•GPUè®­ç»ƒ
world_size: 1                      # å•GPU world size

# æ•°æ®é›†é…ç½®
data_dir: "data"
train_dataset: "11/integrated_aflow_roll/data/ready_to_train/train_final_clean.jsonl"
# ä½¿ç”¨å‡åŒ€åˆ†é…çš„éªŒè¯é›†ï¼ˆæ¯ä¸ªsource 30ä¸ªæ ·æœ¬ï¼Œå…±180ä¸ªï¼‰
val_dataset: "11/integrated_aflow_roll/data/ready_to_train/test.jsonl"
test_dataset: "11/integrated_aflow_roll/data/ready_to_train/test.jsonl"

# æ··åˆé‡‡æ ·æ¯”ä¾‹
domain_ratios:
  math: 0.4      # 40% æ•°å­¦é—®é¢˜
  code: 0.3      # 30% ä»£ç é—®é¢˜
  qa: 0.3        # 30% QAé—®é¢˜

# AFlowé…ç½®
aflow_config_path: "config/aflow_llm.yaml"
aflow_executor_model: "gpt-oss-120b"  # ä½¿ç”¨8002ç«¯å£çš„gpt-oss-120b
aflow_operators: ["Custom", "AnswerGenerate", "Programmer", "ScEnsemble", "Test", "Review", "Revise"]
aflow_operator_descriptions_path: "/home/yijia/.claude/11/AFlow/workspace/MATH/workflows/template/operator.json"
execution_timeout: 600             # å·¥ä½œæµæ‰§è¡Œè¶…æ—¶ï¼ˆç§’ï¼‰ï¼Œå¢åŠ åˆ°600ä»¥æ”¯æŒå¤æ‚å·¥ä½œæµ

# å¥–åŠ±é…ç½®
reward_weights:
  correctness: 0.65   # æ­£ç¡®æ€§æƒé‡
  efficiency: 0.15    # æ•ˆç‡æƒé‡ï¼ˆæˆæœ¬ï¼‰
  simplicity: 0.10    # ç®€æ´æ€§æƒé‡ï¼ˆç®—å­æ•°ï¼‰
  format: 0.05        # æ ¼å¼å¥–åŠ±ï¼ˆæ–°å¢ - ROLLé£æ ¼ï¼‰
  repetition: 0.05    # é‡å¤æƒ©ç½šï¼ˆæ–°å¢ - ROLLé£æ ¼ï¼‰

# ğŸ†• æç¤ºè¯ä¼˜åŒ–ç³»ç»Ÿé…ç½®
# ExperienceBuffer - é«˜è´¨é‡æ ·æœ¬ç®¡ç†
experience_buffer:
  enabled: true
  buffer_size: 100                # æ¯ä¸ªé—®é¢˜ç±»å‹ä¿ç•™çš„æœ€å¤§æ ·æœ¬æ•°
  reward_threshold: 8.0           # é«˜è´¨é‡æ ·æœ¬çš„å¥–åŠ±é˜ˆå€¼ï¼ˆ0-10åˆ†ï¼‰
  persistence_dir: "data/experience_buffer"  # æŒä¹…åŒ–ç›®å½•

# PromptOptimizer - Layer 1: Workflowç”Ÿæˆæç¤ºè¯ä¼˜åŒ–
prompt_optimizer:
  enabled: true                   # æ˜¯å¦å¯ç”¨åŠ¨æ€æç¤ºè¯ä¼˜åŒ–
  few_shot_k: 3                   # Few-shotç¤ºä¾‹æ•°é‡
  similarity_threshold: 0.7       # ç›¸ä¼¼åº¦é˜ˆå€¼ï¼ˆ0-1ï¼‰ï¼Œä½äºåˆ™ä¸ä½¿ç”¨

# OperatorPromptEnhancer - Layer 2: Operatoræ‰§è¡Œæç¤ºè¯å¢å¼º
operator_prompt_enhancer:
  enabled: true                   # æ˜¯å¦å¯ç”¨operatorçº§æç¤ºè¯å¢å¼º
  top_k_examples: 2               # æ¯æ¬¡æ£€ç´¢çš„ç¤ºä¾‹æ•°é‡

# ç›‘æ§é…ç½®
wandb:
  enabled: true
  project: "agent-prompt"
  entity: "yao110002-sdfsdfsdfsdf-com"
  api_key: "b42ca0000cf06f97b05eba34f58823ad5f3122a4"
  run_name: null  # è‡ªåŠ¨ç”Ÿæˆ

# Temperatureè°ƒåº¦é…ç½®ï¼ˆç¦ç”¨åŠ¨æ€è°ƒåº¦ï¼‰
temperature_schedule:
  enabled: false                   # ç¦ç”¨åŠ¨æ€æ¸©åº¦è°ƒåº¦
  initial: 0.2
  final: 0.2
  warmup_steps: 0

# ç”Ÿæˆé…ç½®
generation_config:
  temperature: 0.2  # å›ºå®šå€¼0.2ï¼Œä¸å˜
  top_p: 0.95
  top_k: 50
  max_new_tokens: 4096
  do_sample: true

# è°ƒè¯•é€‰é¡¹
debug: false
verbose: true
